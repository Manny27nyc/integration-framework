{
  "name": "ServiceNow",
  "version": "1.0.0",
  "overview": "Create feature flag change requests in ServiceNow.",
  "description": "Efficiently comply with company-wide change management policies by embedding LaunchDarkly approvals into existing ServiceNow workflows.",
  "author": "LaunchDarkly",
  "supportEmail": "support@launchdarkly.com",
  "links": {
    "site": "https://www.servicenow.com/",
    "launchdarklyDocs": "https://docs.launchdarkly.com/integrations/servicenow",
    "privacyPolicy": "https://www.servicenow.com/privacy-statement.html"
  },
  "categories": ["approval"],
  "icons": {
    "square": "assets/images/servicenow-icon.svg",
    "horizontal": "assets/images/servicenow-rectangle.svg"
  },
  "requiresOAuth": true,
  "formVariables": [],
  "capabilities": {
    "approval": {
      "environmentFormVariables": [
        {
          "key": "template",
          "name": "Standard change template",
          "description": "The standard change template to be utilized for all flag changes in this environment.",
          "type": "dynamicEnum",
          "dynamicOptions": {
            "endpoint": {
              "url": "{{oauth.baseURI}}/api/sn_chg_rest/change/standard/template",
              "method": "GET",
              "headers": [
                {
                  "name": "Authorization",
                  "value": "Bearer {{oauth.accessToken}}"
                }
              ]
            },
            "parser": {
              "optionsPath": "/result",
              "optionsItems": {
                "label": "/sys_name/display_value",
                "value": "/sys_id/value"
              }
            }
          }
        }
      ],
      "creationRequest": {
        "endpoint": {
          "url": "{{oauth.baseURI}}/api/sn_chg_rest/change/standard/{{environment.template}}?short_description={{queryEncode context.title.plainText}}&justification={{queryEncode context._links.approval.href}}{{#if context.details.plainText}}%0A%0A{{queryEncode context.details.plainText}}{{/if}}&requested_by={{queryEncode context.member.externalId}}",
          "method": "POST",
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{oauth.accessToken}}"
            }
          ]
        },
        "parser": {
          "approvalId": "/result/sys_id/value",
          "statusValue": "/result/state/value",
          "statusDisplay": "/result/state/display_value",
          "approvalMatcher": "^-1",
          "rejectionMatcher": "^4",
          "urlTemplate": "{{oauth.baseURI}}/change_request.do?sys_id={{queryEncode context.approvalId}}"
        }
      },
      "statusRequest": {
        "endpoint": {
          "url": "{{oauth.baseURI}}/api/sn_chg_rest/change/standard/{{context.approvalId}}",
          "method": "GET",
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{oauth.accessToken}}"
            }
          ]
        },
        "parser": {
          "statusValue": "/result/state/value",
          "statusDisplay": "/result/state/display_value",
          "approvalMatcher": "^-1",
          "rejectionMatcher": "^4"
        }
      },
      "postApplyRequest": {
        "endpoint": {
          "url": "{{oauth.baseURI}}/api/sn_chg_rest/change/standard/{{context.approvalId}}?state=Review",
          "method": "PATCH",
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{oauth.accessToken}}"
            }
          ]
        },
        "parser": {
          "statusValue": "/result/state/value",
          "statusDisplay": "/result/state/display_value",
          "approvalMatcher": "^-1",
          "rejectionMatcher": "^4"
        }
      },
      "deletionRequest": {
        "endpoint": {
          "url": "{{oauth.baseURI}}/api/sn_chg_rest/change/standard/{{context.approvalId}}?state=Canceled",
          "method": "PATCH",
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{oauth.accessToken}}"
            }
          ]
        },
        "parser": {
          "statusValue": "/result/state/value",
          "statusDisplay": "/result/state/display_value",
          "approvalMatcher": "^-1",
          "rejectionMatcher": "^4"
        }
      },
      "memberListRequest": {
        "endpoint": {
          "url": "{{oauth.baseURI}}/api/now/table/sys_user?active=true&sysparm_fields=email,user_name",
          "method": "GET",
          "headers": [
            {
              "name": "Authorization",
              "value": "Bearer {{oauth.accessToken}}"
            }
          ]
        },
        "parser": {
          "memberArrayPath": "/result",
          "memberItems": {
            "memberId": "/user_name",
            "email": "/email"
          }
        }
      }
    }
  }
}
